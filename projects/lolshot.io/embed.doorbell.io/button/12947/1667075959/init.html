var Doorbell=function(){var options={},idOrAppKeyChanged=false,host=null,recaptchaWidgetID=null,embedHost='https://embed.doorbell.io',submitting=false,uploading=false,uploadedAttachments=[],uploadedPastedAttachments=[],pastedAttachments=[],isPostmessageIframeLoaded=false,prepareFeedbackCallback=null,formQuestions=[],properties={},screenshot='',screenshotData={html:null},container=null,backgroundContainer=null,feedbackButton=null,defaultOptions={},npsRatingAllowed=false,alwaysOnScreenshot=false,emailAddressRequired=true,feedbackRequired=true,screenshotAssetErrors=false,ssLogLines=[],screenshotInlinedAssets=false,screenshotNestedInlinedAssets=false,generatingScreenshot=false,generatingScreenshotTime=0,generatingScreenshotCancelFunc=null,submitAfterScreenshot=false,languageStrings={},setFormQuestionValues={},ariaHiddenElements=[],ariaTabIndexElements=[],autohideFormTimeout=null,defaultStrings={'title':'Feedback','intro-text':'','feedback-textarea-placeholder':'Send us your comments or suggestions...','feedback-label':'','attach-a-screenshot':'Attach a screenshot','email-input-placeholder':'Your email address','email-label':'','submit-button-text':'Send','submitting-button-text':'Sending...','uploading-button-text':'Uploading...','feedback-button-text':'Feedback','add-attachments-label':'','add-attachments-label-button':'Upload files','nps-rating-label':'How would you rate us?','nps-rating-bad-label':'Not that good','nps-rating-good-label':'Great','message-success':'Feedback sent!','message-error-missing-email':null,'message-error-invalid-email':null,'message-error-missing-message':null,'message-error-message-too-short':null},option=function(o){if(typeof options[o]!=='undefined'){return options[o];}else if(typeof defaultOptions[o]!=='undefined'){return defaultOptions[o];}else{return null;}},canUploadAttachments=function(){if(!supportAjaxUploadWithProgress()){return false;}
return false;},installed=function(){return!!1;},getLanguage=function(){var l=option('language');if(l){return l;}
var html=document.getElementsByTagName('html');if(html.length>0){l=html[0].getAttribute('lang');if(l){return l;}}
var metaTags=document.getElementsByTagName('meta');if(metaTags.length>0){var contentLanguageMetaValues=[];for(var i=0;i<metaTags.length;i++){var httpEquiv=metaTags[i].getAttribute('http-equiv');if(!httpEquiv){continue;}
var value=metaTags[i].getAttribute('content');if(!value){continue;}
if(httpEquiv.toLowerCase()!=='content-language'){continue;}
contentLanguageMetaValues.push(value);}
if(contentLanguageMetaValues.length===1){return contentLanguageMetaValues[0];}}
return null;},getString=function(s){var strings=option('strings');if(strings!==null&&typeof strings==='object'&&typeof strings[s]!=='undefined'){return strings[s];}
var language=getLanguage();if(language!==null){if(typeof languageStrings[language]==='object'){if(typeof languageStrings[language][s]!=='undefined'){if(languageStrings[language][s]){return languageStrings[language][s];}}}}
if(typeof defaultStrings[s]!=='undefined'){return defaultStrings[s];}
return null;},getAppId=function(){return'12947';},getAppKey=function(){return options.appKey;},disableButton=function(text){var button=el('doorbell-submit-button');if(!button.disabled){button.className+=' disabled';button.disabled=true;var currentText=button.innerHTML;button.setAttribute('data-original-text',currentText);}
if(typeof text!=='undefined'&&text.length>0){button.innerHTML=text;}},enableButton=function(){var button=el('doorbell-submit-button');button.className=button.className.replace('disabled','');button.disabled=false;button.innerHTML=button.getAttribute('data-original-text');},supportAjaxUploadWithProgress=function(){function supportFileAPI(){var fi=document.createElement('INPUT');fi.type='file';return'files'in fi;}
function supportAjaxUploadProgressEvents(){var xhr=new XMLHttpRequest();return!!(xhr&&('upload'in xhr)&&('onprogress'in xhr.upload));}
function supportFormData(){return!!window.FormData;}
try{return supportFileAPI()&&supportAjaxUploadProgressEvents()&&supportFormData();}catch(e){return false;}},canGenerateScreenshot=function(){return(typeof html2canvas==='function'||typeof DoorbellScreenshot==='function');},canSendScreenshot=function(){return(isPostmessageIframeLoaded||supportAjaxUploadWithProgress())&&canGenerateScreenshot()&&false;},isNPSEnabled=function(){if(!npsRatingAllowed){return false;}
if(typeof options.nps!=='undefined'){return options.nps;}
return npsRatingAllowed;},showForm=function(){var onShowCallback=option('onShow');if(typeof onShowCallback==='function'){if(onShowCallback()===false){return;}}
try{var screenResolution=screen.width+'x'+screen.height;addProperty('Screen resolution',screenResolution);}catch(e){}
try{var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName('body')[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight;setBrowserSize(x,y);}catch(e){}
openForm();var shouldGenerateScreenshot=true;var onGenerateScreenshotCallback=option('onGenerateScreenshot');if(typeof onGenerateScreenshotCallback==='function'){if(onGenerateScreenshotCallback()===false){shouldGenerateScreenshot=false;}}
if(canSendScreenshot()===true&&shouldGenerateScreenshot===true){try{if(typeof html2canvas==='function'){var proxy=host+'/html2canvasproxy.php';generatingScreenshot=true;generatingScreenshotTime=0;var screenshotStart=new Date().getTime();html2canvas([document.body],{proxy:proxy,async:true,logging:!!'',onrendered:function(canvas){generatingScreenshotTime=(new Date().getTime())-screenshotStart;screenshot=canvas.toDataURL();var onScreenshotGeneratedCallback=option('onScreenshotGenerated');if(typeof onScreenshotGeneratedCallback==='function'){onScreenshotGeneratedCallback(screenshot);}
generatingScreenshot=false;if(submitAfterScreenshot){submit();}}});}
var alwaysInline=option('alwaysInline');if(typeof alwaysInline!=='boolean'){alwaysInline=false;}
var inlineStyles=option('inlineStyles');if(typeof inlineStyles!=='boolean'){inlineStyles=false;}
screenshotData.pagesize=htmlEditor.page_size();screenshotData.scrollposition=htmlEditor.window_scroll_position();screenshotData.devicePixelRatio=window.devicePixelRatio;screenshotData.html=null;initScreenshot(null,inlineStyles,alwaysInline);}catch(e){var attachScreenshotCheckboxWrapper=el('doorbell-attach-screenshot-wrapper');if(attachScreenshotCheckboxWrapper){attachScreenshotCheckboxWrapper.style.display='none';}}}},getScroll=function(){if(window.pageYOffset!=undefined){return[pageXOffset,pageYOffset];}else{var sx,sy,d=document,r=d.documentElement,b=d.body;sx=r.scrollLeft||b.scrollLeft||0;sy=r.scrollTop||b.scrollTop||0;return[sx,sy];}},getYScroll=function(){return getScroll()[1];},isInline=function(){return option('container')!==null;},isModal=function(){return!isInline();},openForm=function(){if(canSendScreenshot()===true&&typeof html2canvas==='function'){window.scroll(0,0);}
var emailField=el('doorbell-email');var emailLabel=el('doorbell-email-label');if(option('hideEmail')){emailField.style.display='none';if(emailLabel){emailLabel.style.display='none';}}else{emailField.style.display='block';if(emailLabel){emailLabel.style.display='block';}}
if(option('email')!==null){emailField.value=option('email');}
container.style.display='block';container.setAttribute('aria-hidden','false');try{ariaAdjustingForBodyChildren();}catch(e){}
if(isModal()){backgroundContainer.style.display='block';backgroundContainer.setAttribute('aria-hidden','false');container.style.top=getYScroll()+100+'px';if(shouldAutoFocusFields()){el('doorbell-feedback').focus();}}
formOpened();var onShownCallback=option('onShown');if(typeof onShownCallback==='function'){onShownCallback();}},ariaAdjustingForBodyChildrenReset=function(){if(isInline()){return;}
var i,element,previous;for(i=0;i<ariaHiddenElements.length;i++){element=ariaHiddenElements[i];previous=element.getAttribute('data-doorbell-previous-aria-hidden');if(previous){element.setAttribute('aria-hidden',previous);element.removeAttribute('data-doorbell-previous-aria-hidden');}else{element.removeAttribute('aria-hidden');}}
for(i=0;i<ariaTabIndexElements.length;i++){element=ariaTabIndexElements[i];previous=element.getAttribute('data-doorbell-previous-tabindex');if(previous){element.setAttribute('tabindex',previous);element.removeAttribute('data-doorbell-previous-tabindex');}else{element.removeAttribute('tabindex');}}
ariaHiddenElements=[];ariaTabIndexElements=[];},ariaAdjustingForBodyChildren=function(){if(isInline()){return;}
var i,previous;var excludeChildrenOfElements=[container,backgroundContainer];if('querySelectorAll'in document){var focusable=document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');for(i=0;i<focusable.length;i++){var element=focusable[i];if(element.tagName.toLowerCase()==='link'){continue;}
if(isDescendant(excludeChildrenOfElements,element)){continue;}
previous=element.getAttribute('tabindex');if(previous){element.setAttribute('data-doorbell-previous-tabindex',previous);}
element.setAttribute('tabindex','-1');ariaTabIndexElements.push(element);}
return;}
if(!document.body){return;}
var excludeElementIDs=['doorbell','doorbell-background'];var children=document.body.childNodes;for(i=0;i<children.length;i++){var child=children[i];if(!child){continue;}
if(child.id&&excludeElementIDs.indexOf(child.id)>=0){continue;}
if(!('getAttribute'in child)){continue;}
previous=child.getAttribute('aria-hidden');if(previous){child.setAttribute('data-doorbell-previous-aria-hidden',previous);}
child.setAttribute('aria-hidden','true');ariaHiddenElements.push(child);}},isDescendant=function(parents,child){var node=child.parentNode;while(node!=null){for(var i=0;i<parents.length;i++){if(node==parents[i]){return true;}}
node=node.parentNode;}
return false;},el=function(id){if(container&&'querySelector'in container){return container.querySelector('#'+id);}
return document.getElementById(id);},hideForm=function(){if(autohideFormTimeout){clearTimeout(autohideFormTimeout);autohideFormTimeout=null;}
if(container.style.display==='none'){return;}
var onHideCallback=option('onHide');if(typeof onHideCallback==='function'){if(onHideCallback()===false){return;}}
cancelCurrentScreenshot('hiding form');var successContainer=getAlertBox('success');successContainer.style.display='none';hideErrorMessage();try{ariaAdjustingForBodyChildrenReset();}catch(e){}
if(isModal()){backgroundContainer.style.display='none';backgroundContainer.setAttribute('aria-hidden','true');}
container.style.display='none';container.setAttribute('aria-hidden','true');screenshot='';var onHiddenCallback=option('onHidden');if(typeof onHiddenCallback==='function'){onHiddenCallback();}},getSuccessMessage=function(defaultMessage){var successMessage=option('successMessage');if(successMessage){return successMessage;}
successMessage=getString('message-success');if(successMessage){return successMessage;}
return defaultMessage;},getErrorCode=function(error){if(typeof error==='string'){return null;}
if(typeof error==='object'){return error.type;}
return null;},getErrorField=function(error){if(typeof error==='string'){return null;}
if(typeof error==='object'&&error.field){return error.field;}
return null;},getErrorMessage=function(error){if(typeof error==='string'){return error;}
if(typeof error==='object'){var errorType=error.type;var errorMessage=getString('message-error-'+errorType);if(errorMessage){return errorMessage;}}
return error.message;},showErrorMessage=function(message){var errorContainer=getAlertBox('error');errorContainer.style.display='block';errorContainer.innerHTML=message;},hideErrorMessage=function(){var errorContainer=getAlertBox('error');errorContainer.style.display='none';},showSuccessMessage=function(message){var successElement=getAlertBox('success');successElement.innerHTML=getSuccessMessage(message);successElement.style.display='block';var autohideForm=true;if(autohideForm){autohideFormTimeout=setTimeout(function(){hideForm();},3000);}},getEmail=function(){return el('doorbell-email').value;},setBrowserSize=function(w,h){var browserSize=w+'x'+h;addProperty('Browser size',browserSize);screenshotData.viewport={width:w,height:h};},clearAriaAttributes=function(input,textarea,select){var i;for(i=0;i<input.length;i++){input[i].removeAttribute('aria-describedby');}
for(i=0;i<textarea.length;i++){textarea[i].removeAttribute('aria-describedby');}
for(i=0;i<select.length;i++){select[i].removeAttribute('aria-describedby');}},getValuesOfExtraFormFields=function(input,textarea,select){var extraFields={};var formFields,formFieldCounter,field;var ignoreFields=['doorbell-feedback','doorbell-email','g-recaptcha-response'];var ignoreFieldsByName=['doorbell-nps-rating'];formFields=input;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(field.id&&field.id.length>=18&&field.id.substr(0,18)==='doorbell-question-'){continue;}
if(ignoreFields.indexOf(field.id)>=0){continue;}
if(ignoreFieldsByName.indexOf(field.name)>=0){continue;}
if(field.value.length>0&&field.name.length>0){if(field.type=='radio'||field.type=='checkbox'){if(field.checked){extraFields[field.name]=field.value;}}else if(field.type=='file'){}else{extraFields[field.name]=field.value;}}}
formFields=textarea;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];if(ignoreFields.indexOf(field.id)<0&&field.value.length>0&&field.name.length>0){extraFields[field.name]=field.value;}}
var selectValue;formFields=select;for(formFieldCounter=0;formFieldCounter<formFields.length;formFieldCounter++){field=formFields[formFieldCounter];selectValue=field.options[field.selectedIndex].value;if(ignoreFields.indexOf(field.id)<0&&selectValue.length>0&&field.name.length>0){extraFields[field.name]=selectValue;}}
return extraFields;},isEmpty=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return true;},formHasFiles=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){return true;}}}
return false;},clearFileInput=function(oldInput){try{var newInput=document.createElement("input");newInput.type="file";newInput.id=oldInput.id;newInput.className=oldInput.className;newInput.name=oldInput.name;newInput.multiple=oldInput.multiple;newInput.onchange=oldInput.onchange;oldInput.parentNode.replaceChild(newInput,oldInput);}catch(e){log(e);}},clearFileInputsInForm=function(form){if(!form){return false;}
var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.type==='file'){if(input.files&&input.files.length>0){clearFileInput(input);}}}
return false;},resetAttachmentLabelButtonText=function(){if(!getString('add-attachments-label-button')){return;}
var label=el('doorbell-add-attachments-label-button');if(!label){return;}
label.innerHTML=getAttachmentLabelButtonText(getString('add-attachments-label-button'));},getNPSRating=function(){var radio=container.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){return radio[i].value;}}
return 0;},getFormQuestionValues=function(){var values=[];for(var i=0;i<formQuestions.length;i++){var question=formQuestions[i];var value=getFormQuestionValue(question);if(!value){continue;}
values.push('form_questions['+question.id+']='+encodeURIComponent(value));}
return values.join('&');},getFormQuestionValue=function(question){if(typeof setFormQuestionValues[question.id.toString()]!=='undefined'){return setFormQuestionValues[question.id.toString()];}
if(question.type==='radio'||question.type==='priority'){if(question.options.values.length===0){return null;}
for(var i=0;i<question.options.values.length;i++){var element=el('doorbell-question-'+question.id+'-value-'+i);if(!element){continue;}
if(!element.checked){continue;}
return element.value;}
return null;}
if(question.type==='checkbox'){if(question.options.values.length===0){return null;}
var values=[];for(var i=0;i<question.options.values.length;i++){var element=el('doorbell-question-'+question.id+'-value-'+i);if(!element){continue;}
if(!element.checked){continue;}
values.push(element.value);}
if(values.length>0){return JSON.stringify(values);}
return null;}
if(question.type==='star-rating'&&question.rater){return question.rater.getRating();}
if(question.type==='text'){var element=el('doorbell-question-'+question.id+'-input');if(!element){return null;}
return element.value;}
if(question.type==='dropdown'){var element=el('doorbell-question-'+question.id+'-dropdown');if(!element){return null;}
return element.value;}
return null;},submit=function(customMessage,customEmail,successCallback,errorCallback){debugLog('Calling submit');if(nativeOnSubmit()===false){return;}
var onSubmitCallback=option('onSubmit');if(typeof onSubmitCallback==='function'){if(onSubmitCallback()===false){return;}}
if(submitting||uploading){return false;}
hideErrorMessage();var uploadErrorCallback=function(text){uploading=false;showErrorMessage(text);enableButton();};var uploadForm=el('doorbell-form');if(uploadedAttachments.length===0&&uploadForm&&formHasFiles(uploadForm)){uploading=true;disableButton(getString('uploading-button-text'));if(uploadForm&&formHasFiles(uploadForm)){uploadFile(uploadForm,function(attachments){uploading=false;uploadedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}
return false;}
var i;if(uploadedPastedAttachments.length===0&&pastedAttachments.length>0){uploading=true;disableButton(getString('uploading-button-text'));if(pastedAttachments.length>0){for(i=0;i<pastedAttachments.length;i++){uploadPastedFile(pastedAttachments[i],function(attachments){uploading=false;uploadedPastedAttachments=attachments;submit(customMessage,customEmail,successCallback,errorCallback);},uploadErrorCallback);}}
return false;}
var wantToSendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked){wantToSendScreenshot=true;}
disableButton(getString('submitting-button-text'));if(wantToSendScreenshot&&generatingScreenshot){debugLog('Waiting for screenshot to complete');submitAfterScreenshot=true;return;}
submitAfterScreenshot=false;submitting=true;var fullStoryURL=getFullStorySessionURL();if(fullStoryURL!==null){addProperty('FullStory session',fullStoryURL);}
var logRocketURL=getLogRocketSessionURL();if(logRocketURL!==null){addProperty('LogRocket session',logRocketURL);}
var sessionStackURL=getSessionStackSessionURL();if(sessionStackURL!==null){addProperty('SessionStack session',sessionStackURL);}
var smartlookURL=getSmartLookSessionURL();if(smartlookURL!==null){addProperty('SmartLook session',smartlookURL);}
var feedback=el('doorbell-feedback').value;if(typeof prepareFeedbackCallback==='function'){feedback=prepareFeedbackCallback(feedback);}
if(typeof option('onPrepareFeedback')==='function'){feedback=option('onPrepareFeedback')(feedback);}
var email=getEmail();if(typeof customMessage!=='undefined'){feedback=customMessage;}
if(typeof customEmail!=='undefined'){email=customEmail;}
try{var form=el('doorbell-form');var extraFields;if(form){var inputFields=form.getElementsByTagName('input');var textareaFields=form.getElementsByTagName('textarea');var selectFields=form.getElementsByTagName('select');clearAriaAttributes(inputFields,textareaFields,selectFields);extraFields=getValuesOfExtraFormFields(inputFields,textareaFields,selectFields);if(!isEmpty(extraFields)){addProperty('Fields',extraFields);}}}catch(e){log('Failed to get extra properties from fields');}
var serializedProperties;try{serializedProperties=JSON.stringify(properties);}catch(e){log('Failed to serialize the properties');serializedProperties=properties;}
var data='message='+encodeURIComponent(feedback)+'&email='+encodeURIComponent(email)+'&properties='+encodeURIComponent(serializedProperties);var name=option('name');if(name!==null){data+='&name='+encodeURIComponent(name);}
var formQuestionValues=getFormQuestionValues();if(formQuestionValues){data+='&'+formQuestionValues;}
var tags=option('tags');if(tags!==null){if(Object.prototype.toString.call(tags)==='[object Array]'){tags=tags.join(',');}
if(typeof tags==='string'){data+='&tags='+encodeURIComponent(tags);}}
if(uploadedAttachments.length>0){for(i=0;i<uploadedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedAttachments[i]);}}
if(uploadedPastedAttachments.length>0){for(i=0;i<uploadedPastedAttachments.length;i++){data+='&attachments[]='+encodeURIComponent(uploadedPastedAttachments[i]);}}
if(wantToSendScreenshot&&ssLogLines.length>0){data+='&screenshot_debug_log='+encodeURIComponent(JSON.stringify(ssLogLines));}
data+='&error_detail=1';try{var npsRating=getNPSRating();if(isNPSEnabled()&&npsRating>0){data+='&nps='+npsRating;}}catch(e){}
if(option('sentiment')){data+='&sentiment='+option('sentiment');}
if(generatingScreenshotTime){data+='&screenshot_generation_time='+generatingScreenshotTime;}
var l=getLanguage();if(l){data+='&language='+encodeURIComponent(l);}
if(recaptchaWidgetID!==null){var recaptchaResponse=grecaptcha.getResponse(recaptchaWidgetID);data+='&g-recaptcha-response='+encodeURIComponent(recaptchaResponse);}
if(option('demo')){data+='&demo=1';}
debugLog('Submitting');ajax({url:host+'/api/applications/'+getAppId()+'/submit',data:data,success:function(data){el('doorbell-feedback').value='';updateCharacterCount(el('doorbell-feedback'));clearFileInputsInForm(form);uploadedAttachments=[];pastedAttachments=[];uploadedPastedAttachments=[];ssLogLines=[];if(typeof clearSSLog==='function'){clearSSLog();}
refreshAttachmentsLabel();clearNPSRatingFields();clearFormQuestionFields();clearRecaptcha();var onSuccessCallback=option('onSuccess');if(typeof onSuccessCallback==='function'){onSuccessCallback();}
if(typeof successCallback==='function'){successCallback(data);}
showSuccessMessage(data);},error:function(error){var errorMessage=getErrorMessage(error);showErrorMessage(errorMessage);var errorCode=getErrorCode(error);var errorField=getErrorField(error);if(errorField){var affectedField=getFieldByName(errorField);if(affectedField){affectedField.setAttribute('aria-describedby','doorbell-error');}}
if(errorCode==='invalid-email'||errorCode==='missing-email'){var emailField=el('doorbell-email');if(emailField){emailField.style.display='block';}}
var onErrorCallback=option('onError');if(typeof onErrorCallback==='function'){onErrorCallback(errorCode,errorMessage);}
if(typeof errorCallback==='function'){errorCallback(errorMessage);}},complete:function(){submitting=false;enableButton();}});},getFieldByName=function(name){return el('doorbell-'+name);},clearNPSRatingFields=function(){var radio=container.getElementsByClassName('doorbell-nps-rating');for(var i=0;i<radio.length;i++){if(radio[i].checked){radio[i].checked=false;}}},clearFormQuestionFields=function(){for(var i=0;i<formQuestions.length;i++){var question=formQuestions[i];if(question.type==='radio'||question.type==='priority'||question.type==='checkbox'){for(var j=0;j<question.options.values.length;j++){var element=el('doorbell-question-'+question.id+'-value-'+j);if(!element){continue;}
element.checked=false;}}else if(question.type==='star-rating'&&question.rater){question.rater.clear();}else if(question.type==='dropdown'){var element=el('doorbell-question-'+question.id+'-dropdown');element.value='';}else if(question.type==='text'){var element=el('doorbell-question-'+question.id+'-input');element.value='';}}},isElementVisible=function(el){if(isInline()){return fallbackIsElementVisible(el);}
if(!el.getClientRects){return fallbackIsElementVisible(el);}
try{return!!(el.offsetWidth||el.offsetHeight||el.getClientRects().length);}catch(e){return fallbackIsElementVisible(el);}},fallbackIsElementVisible=function(el){var style=window.getComputedStyle(el);return!(style.display==='none')},isSessionRecordingEnabled=function(){return false;},getLogRocketSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['LogRocket']==='undefined'){return null;}
var logRocket=window['LogRocket'];if(typeof logRocket['sessionURL']==='undefined'){return null;}
var logRocketURL=logRocket.sessionURL;if(!logRocketURL){return null;}
return logRocketURL;},getSessionStackSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['SessionStack']==='undefined'){return null;}
var sessionStack=window['SessionStack'];if(typeof sessionStack['getSessionId']!=='function'){return null;}
var sessionStackSessionURL=null;var calledBack=false;var timedOut=false;var timeoutHandler;sessionStack.getSessionId(function(sessionId){if(sessionId!==null){sessionStackSessionURL='https://app.sessionstack.com/player/#/sessions/'+sessionId;}
calledBack=true;});timeoutHandler=setTimeout(function(){timedOut=true;},100);while(!calledBack&&!timedOut){}
if(!timedOut){clearTimeout(timeoutHandler);}
return sessionStackSessionURL;},getSmartLookSessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['smartlook']==='undefined'){return null;}
var smartlook=window['smartlook'];var smartlookSessionURL=null;var calledBack=false;var timedOut=false;var timeoutHandler;smartlook(function(){smartlookSessionURL=smartlook.playUrl;calledBack=true;});timeoutHandler=setTimeout(function(){timedOut=true;},100);while(!calledBack&&!timedOut){}
if(!timedOut){clearTimeout(timeoutHandler);}
return smartlookSessionURL;},getFullStorySessionURL=function(){if(!isSessionRecordingEnabled()){return null;}
if(typeof window['_fs_namespace']==='undefined'){return null;}
var fsNamespace=window['_fs_namespace'];if(typeof window[fsNamespace]==='undefined'){return null;}
var fsObject=window[fsNamespace];if(typeof fsObject['getCurrentSessionURL']!=='function'){return null;}
var fsURL=fsObject.getCurrentSessionURL();if(!fsURL){return null;}
return fsURL;},formOpened=function(){var poweredByLink=el('doorbell-powered-by');var visible='0';if(poweredByLink&&isElementVisible(poweredByLink)){visible='1';}
var demo='';if(option('demo')){demo='&demo=1';}
ajax({url:host+'/api/applications/'+getAppId()+'/open',data:'powered-by-link-visible='+visible+demo,success:function(data){},error:function(error){}});},nativeOnInitialize=function(){},nativeOnSubmit=function(){},ping=function(){if(installed()){return;}
if(option('demo')){return;}
ajax({url:host+'/api/applications/'+getAppId()+'/ping',success:function(data){},error:function(error){}});},debugLog=function(message){var logForKeys=['HdawR4AGD22T2WYxNFagyCslaMeeAmLIk3Po0IurhF8ESIQ1Y4sKMH3gCCkSzlZS'];if(logForKeys.indexOf(getAppKey())<0){return;}
log(message);},log=function(message){if(typeof console!=='undefined'&&typeof console.log!=='undefined'){console.log(message);}},addProperty=function(name,value){properties[name]=value;},getAuthParams=function(){var params='key='+getAppKey()+'&library=javascript';var timestamp=option('timestamp');if(timestamp){params+='&timestamp='+timestamp;}
var token=option('token');if(token){params+='&token='+token;}
var signature=option('signature');if(signature){params+='&signature='+signature;}
return params;},ajax=function(params){if(typeof params.data==='undefined'){params.data='';}
if(params.data.length>0){params.data+='&';}
params.data+=getAuthParams();try{if(window&&window.location&&window.location.href){params.data+='&url='+encodeURIComponent(window.location.href)+'&url_source=window_location_href';}else if(document&&document.documentURI){params.data+='&url='+encodeURIComponent(document.documentURI)+'&url_source=document_documenturi';}else if(document&&document.URL){params.data+='&url='+encodeURIComponent(document.URL)+'&url_source=document_url';}else{params.data+='&no_url=1&url_source=all_blank';}}catch(e){params.data+='&no_url=1&url_source=error_'+encodeURIComponent(e);}
var sendScreenshot=false;if(el('doorbell-attach-screenshot')&&el('doorbell-attach-screenshot').checked&&(screenshot.length>0||screenshotData.html!==null)){sendScreenshot=true;}
var screenshotBlob=null;if(sendScreenshot&&(supportAjaxUploadWithProgress()||isPostmessageIframeLoaded)){if(screenshotData.html!==null){params.data+='&screenshot_data[screen_resolution][width]='+screen.width;params.data+='&screenshot_data[screen_resolution][height]='+screen.height;params.data+='&screenshot_data[viewport][width]='+screenshotData.viewport.width;params.data+='&screenshot_data[viewport][height]='+screenshotData.viewport.height;params.data+='&screenshot_data[pagesize][width]='+screenshotData.pagesize.width;params.data+='&screenshot_data[pagesize][height]='+screenshotData.pagesize.height;params.data+='&screenshot_data[scrollposition][top]='+screenshotData.scrollposition.top;params.data+='&screenshot_data[scrollposition][left]='+screenshotData.scrollposition.left;if(screenshotData.devicePixelRatio){params.data+='&screenshot_data[device_pixel_ratio]='+screenshotData.devicePixelRatio;}
params.data+='&screenshot_data[asset_errors]='+screenshotAssetErrors;params.data+='&screenshot_data[inlined_assets]='+screenshotInlinedAssets;params.data+='&screenshot_data[nested_inlined_assets]='+screenshotNestedInlinedAssets;if(!screenshotBlob){params.data+='&screenshot_data[html]='+encodeURIComponent(screenshotData.html);}}else{params.data+='&screenshot='+screenshot;}}
if(supportAjaxUploadWithProgress()){makeCorsCall(params,screenshotBlob);}else if(isPostmessageIframeLoaded){params.referrer=window.location.href;makePostmessageCall(params);}else{makeJsonpCall(params);}},parseQuery=function(queryString){var query={};var pairs=(queryString[0]==='?'?queryString.substr(1):queryString).split('&');for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');query[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]||'');}
return query;},ajaxCallback=function(data,code,params){if(code>=200&&code<300){if(typeof params.success!=='undefined'){params.success(data);}}else{if(typeof params.error!=='undefined'){params.error(data);}}
if(typeof params.complete!=='undefined'){params.complete(data);}
if(typeof params.callback!=='undefined'){var callback=params.callback;var scriptTag=document.getElementById('doorbell-'+callback);if(scriptTag){removeElementById('doorbell-'+callback);try{delete window[callback];}catch(e){window[callback]=undefined;}}}},makeCorsCall=function(params,screenshotBlob){var xhr=new XMLHttpRequest();xhr.open('POST',params.url,true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){ajaxCallback(e,500,params);return;}
if(readyState==4){if(status>=200&&status<300&&text){ajaxCallback(text,status,params);}else{var data;try{data=JSON.parse(text);}catch(e){data=text;}
ajaxCallback(data,status,params);}}};var sendData=params.data;var usingBlob=false;if(screenshotBlob){try{var formData=new FormData();formData.append('doorbell_screenshot_file',screenshotBlob,'screenshot.html');var q=parseQuery(params.data);for(var k in q){if(!q.hasOwnProperty(k)){continue;}
formData.append(k,q[k]);}
sendData=formData;usingBlob=true;}catch(e){}}
if(!usingBlob){if('setRequestHeader'in xhr){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded;charset=UTF-8');}else{params.data+='&request_headers_supported=0';}}
xhr.send(sendData);},makePostmessageCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};if(typeof doorbellpm!=='undefined'){doorbellpm({target:window.frames["doorbellIframe"],type:"doorbellSend",data:params});}},makeJsonpCall=function(params){var callback='jsonp'+(new Date().getTime());params.callback=callback;if(typeof params.data==='undefined'){params.data='';}
if(params.data!=''){params.data+='&';}
params.data+='callback='+params.callback;window[callback]=function(response){ajaxCallback(response.data,response.code,params);};var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.id='doorbell-'+callback;script.src=params.url+'?'+params.data;script.onerror=function(){removeElementById('doorbell-'+callback);log('Error loading JSONP script: '+script.src);};head.appendChild(script);},clearRecaptcha=function(){if(recaptchaWidgetID!==null){grecaptcha.reset(recaptchaWidgetID);}},refreshAttachmentsLabel=function(){var fileInput=el('doorbell-add-attachments');var label=el('doorbell-add-attachments-label-button');if(label){var fileCount=0;try{if(fileInput.files&&fileInput.files.length>0){fileCount+=fileInput.files.length;}
fileCount+=pastedAttachments.length;}catch(ex){log(ex);}
if(fileCount>0){label.innerHTML=getAttachmentLabelButtonText(getString('add-attachments-label-button')+' ('+fileCount+')');}else{resetAttachmentLabelButtonText();}}},shouldAutoFocusFields=function(){if(!navigator){return true;}
if(!navigator.userAgent){return true;}
if(navigator.userAgent.match('MSIE 10')){return false;}
if(navigator.userAgent.indexOf("Trident")!==-1&&navigator.userAgent.indexOf("rv:11")!==-1){return false;}
return true;},uploadFile=function(form,successCallback,errorCallback){var xhr=new XMLHttpRequest();var urlParam='&no_url=1';try{urlParam='&url='+encodeURIComponent(window.location.href);}catch(e){}
xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams()+urlParam,true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if(status==413){text='Attachment too big';}else if(status==0&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData(form);xhr.send(formData);},uploadPastedFile=function(result,successCallback,errorCallback){var xhr=new XMLHttpRequest();xhr.open('POST',host+'/api/applications/'+getAppId()+'/upload?'+getAuthParams(),true);xhr.onreadystatechange=function(){var status,text,readyState;try{readyState=xhr.readyState;text=xhr.responseText;status=xhr.status;}catch(e){errorCallback(e);return;}
if(readyState==4){if(status>=200&&status<300&&xhr.responseText){var data;try{data=JSON.parse(xhr.responseText);}catch(e){data=xhr.responseText;}
successCallback(data);}else{if((status==0||status==413)&&!text){text='Attachment too big';}
errorCallback(text);}}};var formData=new FormData();var blob=result.file;var name=result.name?result.name:'image.'+blob.type.split('/')[1];formData.append('file',blob,name);xhr.send(formData);},getAlertBox=function(type){var alert=el('doorbell-'+type);if(alert){return alert;}
alert=document.createElement('div');if(type==='success'){alert.id='doorbell-success';alert.className='alert alert-success';}else if(type==='error'){alert.id='doorbell-error';alert.className='alert alert-error alert-danger';}else{return;}
var doorbellContainer=el('doorbell-container');var fieldset=doorbellContainer.getElementsByTagName('fieldset')[0];var existingAlert=doorbellContainer.getElementsByClassName('alert')[0];fieldset.insertBefore(alert,existingAlert);return alert;},getAttachmentLabelButtonText=function(text){var paperclipDataURI='data:image/png;base64,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';return'<span><img src="'+paperclipDataURI+'" alt="Paperclip Icon" />'+text+'</span>';},removeElementById=function(id){var removeEl=document.getElementById(id);if(removeEl){try{removeEl.parentNode.removeChild(removeEl);}catch(e){}}},removeElement=function(element){if(element){try{element.parentNode.removeChild(element);}catch(e){}}},removeDoorbell=function(){removeElement(feedbackButton);removeElement(backgroundContainer);removeElement(container);},showScreenshotWarning=function(){var e=el('attach-screenshot-warning');if(e){e.style.display='inline';}},hideScreenshotWarning=function(){var e=el('attach-screenshot-warning');if(e){e.style.display='none';}},updateCharacterCount=function(textarea){var counter=el('doorbell-character-count');if(counter){counter.innerHTML=textarea.value.length;}},buildFormComponentHTML=function(component){if(component==='intro-text'){return getString('intro-text');}
if(component==='feedback'){var feedbackLabel=getString('feedback-label');if(feedbackLabel){feedbackLabel='<label for="doorbell-feedback" id="doorbell-feedback-label">'+feedbackLabel+'</label>';}
var requiredAttribute='required="required"';if(!feedbackRequired){requiredAttribute='';}
var feedbackTextAreaCharacterCount='';var onchangeAttribute='';if(option('show-character-counter')&&option('max-character-count')){feedbackTextAreaCharacterCount='<p id="doorbell-character-count-container"><span id="doorbell-character-count">0</span><span id="doorbell-character-count-separator">/</span><span id="doorbell-character-count-max">'+option('max-character-count')+'</span></p>'}
var feedbackTextareaAriaLabel='';if(!feedbackLabel){feedbackTextareaAriaLabel='aria-label="'+getString('feedback-textarea-placeholder')+'"';}
var feedbackTextarea='<textarea placeholder="'+getString('feedback-textarea-placeholder')+'" '+feedbackTextareaAriaLabel+' class="form-control" name="message" id="doorbell-feedback" '+onchangeAttribute+' '+requiredAttribute+'></textarea>';return feedbackLabel+feedbackTextarea+feedbackTextAreaCharacterCount;}
if(component==='email'){var emailLabel=getString('email-label');if(emailLabel){emailLabel='<label for="doorbell-email" id="doorbell-email-label">'+emailLabel+'</label>';}
var requiredAttribute='required="required"';if(!emailAddressRequired){requiredAttribute='';}
var emailInputAriaLabel='';if(!emailLabel){emailInputAriaLabel='aria-label="'+getString('email-input-placeholder')+'"';}
return emailLabel+'<input type="email" id="doorbell-email" '+emailInputAriaLabel+' class="form-control" placeholder="'+getString('email-input-placeholder')+'" name="email" value="" '+requiredAttribute+' />';}
if(component==='attachments'){if(!canUploadAttachments()){return'';}
var addAttachmentLabel=getString('add-attachments-label');if(addAttachmentLabel){addAttachmentLabel='<label for="doorbell-add-attachments" id="doorbell-add-attachments-label">'+addAttachmentLabel+'</label>';}else{addAttachmentLabel='';}
var addAttachmentLabelButton='';if(getString('add-attachments-label-button')){addAttachmentLabelButton='<label id="doorbell-add-attachments-label-button" for="doorbell-add-attachments">'+getAttachmentLabelButtonText(getString('add-attachments-label-button'))+'</label>';}
var attachmentInput='<input id="doorbell-add-attachments" class="'+(addAttachmentLabelButton?'has-label-button':'')+'" name="files[]" type="file" multiple="multiple" />';return addAttachmentLabel+addAttachmentLabelButton+attachmentInput;}
if(component==='screenshot'){if(!canSendScreenshot()){return'';}
var attachScreenshotWarning='<span id="attach-screenshot-warning" style="display: none;"> (some assets might be missing)</span>';var attachScreenshotWrapperVisibility='';if(alwaysOnScreenshot){alwaysOnScreenshot='checked="checked"';attachScreenshotWrapperVisibility='display: none;'}
return'<div class="checkbox" id="doorbell-attach-screenshot-wrapper" style="'+attachScreenshotWrapperVisibility+'"><label for="doorbell-attach-screenshot"><input type="checkbox" id="doorbell-attach-screenshot" value="1" '+alwaysOnScreenshot+' /> '+getString('attach-a-screenshot')+attachScreenshotWarning+'</label></div>';}
if(component==='nps'){if(!isNPSEnabled()){return'';}
var npsRating='<label>'+getString('nps-rating-label')+'</label>';npsRating+='<div class="clearfix">';for(var iNPS=0;iNPS<=10;iNPS++){npsRating+='<label id="nps-value-'+iNPS+'" for="nps-checkbox-'+iNPS+'" style="float: left; width: 9.09%; margin: 0; text-align: center;">';npsRating+='<input id="nps-checkbox-'+iNPS+'" class="doorbell-nps-rating" type="radio" name="doorbell-nps-rating" value="'+iNPS+'" /><br /><span>'+iNPS+'</span>';npsRating+='</label>';}
npsRating+='</div>';npsRating+='<p class="clearfix">';npsRating+='<span style="float: left;">'+getString('nps-rating-bad-label')+'</span>';npsRating+='<span style="float: right;">'+getString('nps-rating-good-label')+'</span>';npsRating+='</p>';return npsRating;}
if(component.length>=9&&component.substr(0,9)==='question_'){var questionID=component.replace('question_','');var question=getFormQuestion(questionID);if(!question){return'';}
var questionLabel=question.label;if(getString('form-question-'+questionID+'-label')){questionLabel=getString('form-question-'+questionID+'-label');}
var formQuestion='<div id="doorbell-question-'+questionID+'" class="doorbell-question doorbell-question-type-'+question.type+'">';if(questionLabel){formQuestion+='<label id="doorbell-question-'+questionID+'-label" for="doorbell-question-'+questionID+'">'+questionLabel+'</label>';}
if(question.type==='radio'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];var questionValueLabel=value;var questionValueLabelSlug=value.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="radio" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else if(question.type==='checkbox'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];var questionValueLabel=value;var questionValueLabelSlug=value.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="checkbox" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else if(question.type==='star-rating'){formQuestion+='<div class="doorbell-question-field clearfix"></div>';}else if(question.type==='text'){var requiredAttribute='';if(question.required){requiredAttribute='required="required"';}
var hasHelperText=question.options&&question.options.helper;formQuestion+='<div class="doorbell-question-field clearfix"><input type="text" id="doorbell-question-'+questionID+'-input" aria-label="'+question.label+'" class="form-control" placeholder="'+((question.options&&question.options.placeholder)?question.options.placeholder:'')+'" name="question_'+questionID+'" value="" '+requiredAttribute+' '+(hasHelperText?'style="margin-bottom: 0;"':'')+' />'+(hasHelperText?'<p style="padding: 0; margin: 0 0 10px 0; line-height: 1.42857143;"><small>'+question.options.helper+'</small></p>':'')+'</div>';}else if(question.type==='dropdown'){var requiredAttribute='';if(question.required){requiredAttribute='required="required"';}
var optionsString='<option value="" selected="selected"></option>';for(var i=0;i<question.options.values.length;i++){var value=question.options.values[i];optionsString+='<option value="'+value+'">'+value+'</option>';}
var hasHelperText=question.options&&question.options.helper;formQuestion+='<div class="doorbell-question-field clearfix"><select id="doorbell-question-'+questionID+'-dropdown" aria-label="'+question.label+'" class="form-control" name="question_'+questionID+'" '+requiredAttribute+' '+(hasHelperText?'style="margin-bottom: 0;"':'')+'>'+optionsString+'</select>'+(hasHelperText?'<p style="padding: 0; margin: 0 0 10px 0; line-height: 1.42857143;"><small>'+question.options.helper+'</small></p>':'')+'</div>';}else if(question.type==='priority'){if(question.options.values&&question.options.values.length>0){formQuestion+='<div class="doorbell-question-field clearfix">';for(var i=0;i<question.options.values.length;i++){var questionOption=question.options.values[i];var questionValueLabel=questionOption.label;var questionValueLabelSlug=questionOption.label.toLowerCase().replace(/\s+/g,'-')
if(getString('form-question-'+questionID+'-value-'+questionValueLabelSlug)){questionValueLabel=getString('form-question-'+questionID+'-value-'+questionValueLabelSlug);}
formQuestion+='<div class="doorbell-question-radio"><input type="radio" id="doorbell-question-'+questionID+'-value-'+i+'" name="question_'+questionID+'" value="'+questionOption.value+'" /><label for="doorbell-question-'+questionID+'-value-'+i+'">'+questionValueLabel+'</label></div>';}
formQuestion+='</div>';}}else{return'';}
formQuestion+='</div>';return formQuestion;}
return'';},getFormQuestion=function(id){for(var i=0;i<formQuestions.length;i++){if(formQuestions[i].id==id){return formQuestions[i];}}
return null;},setRecaptchaWidgetID=function(id){recaptchaWidgetID=id;},buildFormHTML=function(){var postMessageIframe='';if(canSendScreenshot()===true){if(!supportAjaxUploadWithProgress()){postMessageIframe='<iframe name="doorbellIframe" id="doorbellIframe" src="'+host+'/api/form?t=1666976494'+'" style="display: none!important;"></iframe>';}}
var components=["intro-text","feedback","email","attachments","screenshot","nps"];var componentsHTML=[];for(var i=0;i<components.length;i++){var componentHTML=buildFormComponentHTML(components[i]);componentsHTML.push(componentHTML);}
return'<div id="doorbell-container" role="dialog" aria-labelledby="doorbell-title"><button id="doorbell-close" title="Close" class="close" aria-label="Close"><span>&times;</span></button><form id="doorbell-form" class="">                <fieldset>                    <legend id="doorbell-title">'+getString('title')+'</legend>                    <div id="doorbell-success" class="alert alert-success" style="display: none;"></div>                    '+componentsHTML.join("\n")+'                                        <div class="buttons"><button class="btn btn-primary" id="doorbell-submit-button">'+getString('submit-button-text')+'</button></div>                </fieldset>                <a href="https://doorbell.io/?utm_source=feedback_form&utm_medium=web_sdk&utm_campaign=application_12947" target="_blank" rel="noopener noreferrer" id="doorbell-powered-by" >Powered by Doorbell.io</a>                '+postMessageIframe+'            </form></div>';},preInit=function(){},cancelCurrentScreenshot=function(reason){if(typeof generatingScreenshotCancelFunc==='function'){ssLogLines=generatingScreenshotCancelFunc(reason);generatingScreenshotCancelFunc=null;}
generatingScreenshot=false;},initScreenshot=function(callback,inlineStyles,alwaysInline){if(typeof htmlEditor==='undefined'||typeof DoorbellScreenshot!=='function'){return;}
cancelCurrentScreenshot('starting new one');if(typeof inlineStyles==='undefined'){inlineStyles=false;}
if(typeof alwaysInline==='undefined'){alwaysInline=false;}
generatingScreenshot=true;hideScreenshotWarning();screenshotAssetErrors=false;screenshotInlinedAssets=false;screenshotNestedInlinedAssets=false;var doorbellScreenshotCallback=function(html,assetErrors,inlinedAssets,nestedInlinedAssets){screenshotAssetErrors=assetErrors;screenshotInlinedAssets=inlinedAssets;screenshotNestedInlinedAssets=nestedInlinedAssets;screenshotData.html=html;generatingScreenshot=false;if(submitAfterScreenshot){submit();}
if(typeof callback==='function'){callback(screenshotData);}};var removeDisplayNoneElements=true;generatingScreenshotCancelFunc=DoorbellScreenshot({inlineStyles:inlineStyles,alwaysInline:alwaysInline,removeDisplayNoneElements:removeDisplayNoneElements,onRendered:function(html,assetErrors,inlinedAssets,nestedInlinedAssets,ssLogLinesReturned){generatingScreenshotCancelFunc=null;ssLogLines=ssLogLinesReturned;if(assetErrors&&!inlineStyles){initScreenshot(callback,true,alwaysInline);}else{doorbellScreenshotCallback(html,assetErrors,inlinedAssets,nestedInlinedAssets);}}});};if('Blob'in window&&'FormData'in window&&canUploadAttachments()){function addPasteImageReaderListener(callback){var options={matchType:/image.*/};if('addEventListener'in window){document.getElementsByTagName('html')[0].addEventListener('paste',function(event){try{if(document.getElementById('doorbell').style.display==='none'){return;}
var element=this;var clipboardData=event.clipboardData;if(!clipboardData){clipboardData=event.originalEvent.clipboardData;}
if(!clipboardData.items){return;}
var hasFiles=false;Array.prototype.forEach.call(clipboardData.types,function(type,i){if(type.match(options.matchType)||clipboardData.items[i].type.match(options.matchType)){var file=clipboardData.items[i].getAsFile();if(file){callback.call(element,{file:file,name:file.name});hasFiles=true;}}});if(hasFiles){event.stopPropagation();event.preventDefault();}}catch(e){}});}}
addPasteImageReaderListener(function(result){pastedAttachments.push(result);refreshAttachmentsLabel();});}
return{init:function(opts){preInit();options=opts;var onLoadCallback=option('onLoad');if(typeof onLoadCallback==='function'){onLoadCallback();}
host='https://doorbell.io';var hideButton=option('hideButton');if((hideButton===null||hideButton===false)&&isModal()){feedbackButton=document.createElement('button');feedbackButton.id='doorbell-button';feedbackButton.onclick=showForm;feedbackButton.className='bottom_right';feedbackButton.style.visibility='hidden';feedbackButton.innerHTML=getString('feedback-button-text');document.body.appendChild(feedbackButton);}
var head=document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0];var includeStylesheets=true;if(includeStylesheets){var stylesheet=document.createElement('link');stylesheet.href='https://embed.doorbell.io/css/doorbell.min.css?v=1666976490';stylesheet.rel='stylesheet';stylesheet.type='text/css';stylesheet.id='doorbell-css-document';var extraStylesheet=null;var extraStylesheetFilename='default.css';if(extraStylesheetFilename.length>0){extraStylesheet=document.createElement('link');extraStylesheet.href='https://embed.doorbell.io/css/'+extraStylesheetFilename+'?v=1666976490';extraStylesheet.rel='stylesheet';extraStylesheet.type='text/css';extraStylesheet.id='doorbell-css-extra';}
var customCSS="";var customCSSElement=null;if(customCSS){customCSSElement=document.createElement('style');customCSSElement.setAttribute('type','text/css');customCSSElement.textContent=customCSS;}
if(!document.getElementById(stylesheet.id)){if(customCSSElement){head.insertBefore(customCSSElement,head.firstChild);}
head.insertBefore(stylesheet,head.firstChild);if(extraStylesheet){head.insertBefore(extraStylesheet,head.firstChild);}}}
var initProperties=option('properties');if(typeof initProperties==='object'&&initProperties!==null){properties=initProperties;}
if(typeof doorbellpm!=='undefined'){doorbellpm.bind("doorbellIframeloaded",function(){isPostmessageIframeLoaded=true;return true;});doorbellpm.bind("doorbellSuccess",function(data){window[data.callback](data);return true;});doorbellpm.bind("doorbellError",function(data){window[data.callback](data);return true;});}
var formHtml=buildFormHTML();if(isModal()){backgroundContainer=document.createElement('div');backgroundContainer.id='doorbell-background';backgroundContainer.className='';backgroundContainer.style.display='none';document.body.appendChild(backgroundContainer);backgroundContainer.onclick=function(e){var evt=(e)?e:window.event;if(evt!=null&&evt.target!=null&&evt.target.id=='doorbell-background'){hideForm();}};}
container=document.createElement('div');container.id='doorbell';container.setAttribute('role','dialog');container.setAttribute('aria-labelledby','doorbell-title');container.setAttribute('tabindex','-1');container.setAttribute('aria-hidden','true');container.innerHTML=formHtml;container.style.display='none';if(isModal()){document.body.appendChild(container);el('doorbell-close').onclick=function(){hideForm();};}else{var inlineContainer=option('container');if(typeof inlineContainer==='function'){inlineContainer=inlineContainer();}
container.className='doorbell-inline';inlineContainer.appendChild(container);}
if(option('show-character-counter')&&option('max-character-count')){el('doorbell-feedback').onchange=function(){updateCharacterCount(this);};el('doorbell-feedback').onkeydown=function(){updateCharacterCount(this);};el('doorbell-feedback').onkeyup=function(){updateCharacterCount(this);};el('doorbell-feedback').onkeypress=function(){updateCharacterCount(this);};el('doorbell-feedback').oninput=function(){updateCharacterCount(this);};}
for(var i=0;i<formQuestions.length;i++){if(formQuestions[i].type!=='star-rating'){continue;}
var questionContainer=el('doorbell-question-'+formQuestions[i].id);var starContainer=questionContainer.getElementsByClassName('doorbell-question-field');if(!starContainer){continue;}
if(starContainer.length!=1){continue;}
starContainer=starContainer[0];var questionRater=rater({element:starContainer,max:5,showToolTip:false,starSize:30,rateCallback:function(rating,done){questionRater.setRating(rating);done();}});formQuestions[i].rater=questionRater;}
var doorbellForm=el('doorbell-form');doorbellForm.onsubmit=function(){submit();return false;};var doorbellInputs=doorbellForm.getElementsByTagName('input');for(var i=0;i<doorbellInputs.length;i++){var input=doorbellInputs[i];if(input.type==='file'){input.onchange=function(e){uploadedAttachments=[];refreshAttachmentsLabel();}}}
el('doorbell-feedback').onkeydown=function(e){var evt=(e)?e:window.event;if((evt.ctrlKey||evt.metaKey)&&evt.keyCode==13){submit();evt.preventDefault();evt.stopPropagation();return false;}};document.onkeydown=function(evt){evt=evt||window.event;if(evt.keyCode==27){hideForm();}};if(el('g-recaptcha-'+getAppId())){var recaptchaCallback='onRecaptchaV2Load'+getAppId();window[recaptchaCallback]=function(){var recaptchaElement=el('g-recaptcha-'+getAppId());if(!recaptchaElement){return;}
var recaptchaSize='normal';var width=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName('body')[0].clientWidth;if(width<430){recaptchaSize='compact';}
var recaptchaWidgetID=grecaptcha.render(recaptchaElement,{sitekey:'6LcG63cUAAAAAO9VuaUdrEU2BnXBvUHr9w58ob8H',size:recaptchaSize});setRecaptchaWidgetID(recaptchaWidgetID);el('g-recaptcha-response').setAttribute('aria-hidden','true')
delete window[recaptchaCallback];};var recaptchaScript=document.createElement('script');recaptchaScript.src='https://www.google.com/recaptcha/api.js?onload='+recaptchaCallback+'&render=explicit';if(getLanguage()){recaptchaScript.src+='&hl='+getLanguage();}
document.body.appendChild(recaptchaScript);}
nativeOnInitialize();var onInitialized=option('onInitialized');if(typeof onInitialized==='function'){onInitialized();}
ping();if(isInline()){showForm();}},getProperty:function(name){if(typeof properties[name]!=='undefined'){return properties[name];}else{return null;}},setProperty:function(name,value){addProperty(name,value);},setBrowserSize:function(width,height){setBrowserSize(width,height);},getOption:function(o){return option(o);},setOption:function(option,value){options[option]=value;if(option==='id'||option==='appKey'){idOrAppKeyChanged=true;}},setName:function(newName){options.name=newName;},show:function(){showForm();},hide:function(){hideForm();},send:function(message,email,successCallback,errorCallback){submit(message,email,successCallback,errorCallback);},remove:function(){removeDoorbell();},refresh:function(){removeDoorbell();if(!idOrAppKeyChanged){this.init(options);}else{var currentScript=document.getElementById('doorbellScript');if(currentScript){currentScript.parentNode.removeChild(currentScript);}
var g=document.createElement('script');g.id='doorbellScript';g.type='text/javascript';g.async=true;g.src=embedHost+'/button/'+getAppId()+'?t='+(new Date().getTime());(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(g);}},showError:function(message){showErrorMessage(message);},setQuestionValue:function(questionID,value){setFormQuestionValues[questionID.toString()]=value;},initScreenshot:function(callback){screenshotData.pagesize=htmlEditor.page_size();screenshotData.scrollposition=htmlEditor.window_scroll_position();screenshotData.devicePixelRatio=window.devicePixelRatio;screenshotData.html=null;initScreenshot(callback);}};};if(typeof window.html2canvas==='undefined'){}
(function(){var doorbellOptionsVarName='doorbellOptions';var doorbellObjectName='doorbell';var options;if(typeof window[doorbellOptionsVarName]==='undefined'){return;}else if(typeof window[doorbellOptionsVarName].appKey==='undefined'){return;}else{options=window[doorbellOptionsVarName];}
window[doorbellObjectName]=new Doorbell();window[doorbellObjectName].init(options);})();